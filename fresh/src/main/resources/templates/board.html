<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<th:block th:insert="~{menu.html::metaImport}"></th:block>
<title>掲示板</title>
<th:block th:insert="~{menu.html::headImport}"></th:block>
<style>
/* 基本スタイル */
body {
	
	width:1300pt;
	height:100%;
	font-family: 'Arial', sans-serif;
	background-color: #f8f9fa;
	margin: 0;
	padding: 0;
}

/* ナビゲーションバースタイル */

/* 掲示板スタイル */
.board-container {
	display: flex;
	flex-direction: column;
	margin: 20px auto;
	width: 95%;
	max-width: 1320px;
	background-color: white;
	box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
	border-radius: 8px;
	padding: 20px;
}

.search-container {
	display: flex;
	justify-content: space-between;
	margin-bottom: 20px;
	align-items: center;
}

.search-container input[type="text"] {
	padding: 8px;
	width: 85%;
	border: 1px solid #ccc;
	border-radius: 5px;
}

.search-container button {
	padding: 8px 15px;
	background-color: #333;
	color: white;
	border: none;
	border-radius: 5px;
	cursor: pointer;
}

.search-container button:hover {
	background-color: #0056b3;
}

.search-container form {
	display: flex;
	align-items: center; /* 検索ボックスとボタンを同じラインに配置 */
}

.search-container select, .search-container input {
	margin-right: 5px; /* 検索ボックスとボタンの間隔 */
}

/* 掲示板リストスタイル */
.board-list {
	width: 100%;
	table-layout: fixed;
	border-collapse: collapse;
	margin-top: 20px;
	border-radius: 8px;
	overflow: hidden;
}

.board-list th, .board-list td {
	padding: 12px;
	text-align: center;
	border: 1px solid #ddd;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap; /* テキストが長くなる場合、改行を防止 */
}

.board-list th {
	background-color: #f8f9fa;
	color: #495057;
	cursor: pointer;
}

.board-list td a {
	text-decoration: none;
	color: #495057;
}

.board-list td a:hover {
	color: #007bff;
}
/* タイトル以外の列の幅を狭める */

.board-list th:nth-child(3),
.board-list td:nth-child(3),
.board-list th:nth-child(4),
.board-list td:nth-child(4) {
	width: 12%;
}
.board-list th:nth-child(1),
.board-list td:nth-child(1),
.board-list th:nth-child(5),
.board-list td:nth-child(5),
.board-list th:nth-child(6),
.board-list td:nth-child(6) {
    width: 6%; /* 番号、ユーザー名、デート、ビュー、♥を狭くする */
}


/* 下段のスタイル */

.items-per-page {
	margin-top: 20px;
}

.items-per-page label {
	font-size: 1rem;
}

.items-per-page select {
	padding: 5px;
	font-size: 1rem;
	border-radius: 5px;
	border: 1px solid #ccc;
}
/* 反応型スタイル */
@media ( max-width : 768px) {
	.search-container {
		flex-direction: column;
		align-items: flex-start;
	}
	.search-container input[type="text"], .search-container button {
		width: 100%;
		margin-bottom: 10px;
	}


}

</style>
</head>
<body>
	<div class="container">
		<!-- ナビゲーション バー (空き) -->
		<th:block th:insert="~{menu.html::navBar}"></th:block>

		<!-- 掲示板 エリア -->
		<div class="board-container">
			<!-- 検索ボックスエリア -->
			<div class="search-container">
				<div>掲示板</div>
				<div>
					<form>
						<select name="type" class="type-box">
							<option value="">検索タイプ</option>
							<option value="title">タイトル</option>
							<option value="write">ユーザー名</option>
						</select> 
						<span><input type="text" name="keyword" placeholder="検索語入力"></span>
						<button type="button" onclick="searchPosts();">検索</button>
					</form>
				</div>
			</div>

			<!-- ポストの数変更 -->
			<div class="items-per-page">
				<label for="itemsPerPage">ポスト数: </label>
				<select id="itemsPerPage" onchange="updateItemsPerPage()">
					<option value="10">10固</option>
					<option value="20">20固</option>
					<option value="30">30固</option>
				</select>
			</div>
			<!-- ポストリスト -->
			<table class="board-list" id="boardList">
				<thead>
					<tr>
						<th>No</th>
						<th>タイトル</th>
						<th>ユーザー名</th>
						<th>作成日</th>
						<th>ビュー</th>
						<th>♥</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="board:${BoardList}">
						<td><span th:text="${board.board_no}"></span></td>
						<td><span th:text="${board.board_title}"></span></td>
						<td><span th:text="${board.board_write}"></span></td>
						<td><span th:text="${board.board_date}"></span></td>
						<td><span th:text="${board.board_count}"></span></td>
						<td><span th:text="${board.board_like}"></span></td>
					</tr>
				</tbody>
			</table>

			<!-- ページ番号 ＆ ナビゲーション -->
			<div class="pagination">
				<div class="pagination-btn">
				<button class="prev-btn" onclick="changePage('prev')">Prev</button>
				<span class="page-info">現在ページ: 1 / 1</span>
				<!-- ページ番号表示 -->
				<button class="prev-btn" onclick="changePage('next')">Next</button>
				</div>
				<div class="write-button">
				<!-- 作成ボタン -->
				<button th:onclick="'location.href=\''+@{/boardWrite}+'\''">ポスト作成</button>
				</div>
			</div>
			<!-- ページ移動する時、メッセージ出力 -->
			<div class="page-info" id="message"></div>
		</div>
	</div>
	<script th:inline="javascript">
    /*<![CDATA[*/
    let posts = /*[[${BoardList}]]*/ [];  // Thymeleafから 伝達された BoardList データを JSONに変換
    /*]]>*/
	</script>

	<script>
    let currentPage = 1;
    let itemsPerPage = 10; // 基本的に 10固づつ 見せる
    let searchQuery = ""; // 検索語の初期化
    let filteredPosts = []; // フィルターリングされたポストのリスト
    
    // let posts = /*[[${BoardList}]]*/ [];
   

 	// ポスト 表示
    function renderPosts() {
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const postsToDisplay = filteredPosts.slice(startIndex, endIndex);

        const boardList = document.getElementById('boardList').getElementsByTagName('tbody')[0];
        boardList.innerHTML = '';

        postsToDisplay.forEach(post => {
            const row = document.createElement('tr');
            
            
            //作成日のフォーマットを'yyyy-MM-dd'に 変更
            const formattedDate = new Date(post.board_date);
            const formattedDateString = formattedDate.getFullYear() + '-' +
                String(formattedDate.getMonth() + 1).padStart(2, '0') + '-' +
                String(formattedDate.getDate()).padStart(2, '0');
            
            row.innerHTML = `
                <td>${post.board_no}</td>
                <td><a href="/boardview?no=${post.board_no}">${post.board_title}</a></td>
                <td>${post.board_write}</td>
                <td>${formattedDateString}</td>
                <td>${post.board_count}</td>
                <td>${post.board_like}</td>
            `;
            boardList.appendChild(row);
        });

        document.querySelector('.page-info').innerText = `現在ページ: ${currentPage} / ${Math.ceil(filteredPosts.length / itemsPerPage)}`;
    }

 	// ページ変更
    function changePage(direction) {
        if (direction === 'prev' && currentPage > 1) {
            currentPage--; 
        } else if (direction === 'next'&& currentPage < Math.ceil(filteredPosts.length / itemsPerPage)) {
            currentPage++;
        }
        renderPosts();
    }

 	// 検索機能
    function searchPosts() {
        searchQuery = document.querySelector('[name="keyword"]').value; //検索語
        const searchType = document.querySelector('[name="type"]').value; // 検索タイプ

        filteredPosts = posts.filter(post => {
            if (searchType === "title") {
                return post.board_title.includes(searchQuery);
            } else if (searchType === "write") {
                return post.board_write.includes(searchQuery);
            } else {
                return post.board_title.includes(searchQuery) || post.board_write.includes(searchQuery);
            }
        });

        currentPage = 1; // 検索をする時、最初のページへリセット
        renderPosts();
    }

 	// ポストの数変更
    function updateItemsPerPage() {
        itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
        renderPosts();
    }

 	// 初期データをロード
    filteredPosts = posts;
    renderPosts();
</script>

</body>
</html>
