<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="layout/basic">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>게시판</title>
<style>
/* 기본 스타일 */
body {
	font-family: Arial, sans-serif;
	margin: 0;
	padding: 0;
}

/* 네비게이션 바 스타일 */
header {
	background-color: #333;
	color: white;
	padding: 10px 0;
	text-align: center;
}

header a {
	color: white;
	text-decoration: none;
	margin: 0 15px;
}

/* 게시판 영역 스타일 */
.board-container {
	display: flex;
	flex-direction: column;
	margin: 20px;
}

.search-container {
	display: flex;
	justify-content: space-between;
	margin-bottom: 20px;
}

.search-container input[type="text"] {
	padding: 8px;
	width: 80%;
}

.search-container button {
	padding: 8px 15px;
	background-color: #333;
	color: white;
	border: none;
	cursor: pointer;
}

.search-container button:hover {
	background-color: #555;
}

.search-container form {
	display: flex;
	align-items: center; /* 검색창과 버튼을 같은 라인에 배치 */
}

.search-container select, .search-container input {
	margin-right: 5px; /* 검색어 입력창과 버튼 사이 간격 */
}

/* 게시판 리스트 스타일 */
.board-list {
	width: 100%;
	border-collapse: collapse;
	margin-top: 20px;
}

.board-list th, .board-list td {
	padding: 10px;
	text-align: center;
	border: 1px solid #ddd;
}

.board-list th {
	background-color: #f4f4f4;
	cursor: pointer;
}

.board-list td a {
	text-decoration: none;
	color: #333;
}

.board-list td a:hover {
	color: #007BFF;
}

/* 하단 스타일 */
.pagination {
	display: flex;
	justify-content: center;
	align-items: center;
	margin-top: 20px;
}

.pagination button {
	padding: 5px 10px;
	margin: 0 5px;
	background-color: #333;
	color: white;
	border: none;
	cursor: pointer;
}

.pagination button:hover {
	background-color: #555;
}

.pagination span {
	margin: 0 10px;
}

.write-button {
	padding: 15px 20px;
	background-color: #333;
	color: white;
	border: none;
	cursor: pointer;
	font-size: 18px;
}

.write-button:hover {
	background-color: #555;
}

.page-info {
	font-size: 16px;
	color: #333;
}

.items-per-page {
	margin-top: 20px;
}

.items-per-page {
	margin-top: 10px;
	margin-bottom: 20px;
}
</style>
</head>
<body>

	<!-- 네비게이션 바 (비워둠) -->
	<header>
		<!-- 네비게이션 바의 내용은 비워두었습니다. -->
	</header>

	<!-- 게시판 영역 -->
	<div class="board-container">
		<!-- 검색창 -->
		<div class="search-container">
			<div>게시판</div>
			<div>
				<form action="${contextPath}/board/review" method="get"
					id="searchFoam" name="search-form">
					<select name="type" class="type-box">
						<option value="">검색 유형 선택</option>
						<option value="title">제목</option>
						<option value="writer">작성자</option>
					</select> <span><input type="text" name="keyword"
						placeholder="검색어 입력"></span>
					<button type="button" onclick="searchPosts();">검색하기</button>
				</form>
			</div>
		</div>

		<!-- 게시글 수 변경 -->
		<div class="items-per-page">
			<label for="itemsPerPage">게시글 수: </label> <select id="itemsPerPage"
				onchange="updateItemsPerPage()">
				<option value="10">10개</option>
				<option value="20">20개</option>
				<option value="30">30개</option>
			</select>
		</div>

		<!-- 게시판 리스트 -->
		<table class="board-list" id="boardList">
			<thead>
				<tr>
					<th>번호</th>
					<!-- 게시글 번호 추가 -->
					<th>제목</th>
					<th>작성자</th>
					<th>작성일시</th>
					<th>조회수</th>
					<th>추천수</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="board:${BoardList}">
					<td><span th:text="${board.board_no}"></span></td>
					<td><span th:text="${board.board_title}"></span></td>
					<td><span th:text="${board.board_write}"></span></td>
					<td><span th:text="${board.board_date}"></span></td>
					<td><span th:text="${board.board_count}"></span></td>
					<td><span th:text="${board.board_like}"></span></td>
				</tr>
			</tbody>
		</table>

		<!-- 페이지 번호 및 네비게이션 -->
		<div class="pagination">
			<button onclick="changePage('prev')">이전</button>

			<span class="page-info">현재 페이지: 1 / 1</span>
			<!-- 페이지 번호 표시 -->

			<button onclick="changePage('next')">다음</button>
		</div>

		<!-- 메시지 -->
		<div class="page-info" id="message">
			<!-- 여기에 페이지 이동 시 메시지가 출력됩니다 -->
		</div>
	</div>

	<!-- 글쓰기 버튼 -->
	<div
		style="display: flex; justify-content: flex-end; margin-top: 10px;">
		<a th:href="@{/boardWrite}" class="write-button">
			<button>글쓰기</button>
		</a>
	</div>

	<script th:inline="javascript">
    /*<![CDATA[*/
    let posts = /*[[${BoardList}]]*/ [];  // Thymeleaf에서 전달된 BoardList 데이터를 JSON으로 변환
    /*]]>*/
</script>

	<script>
    let currentPage = 1;
    let itemsPerPage = 10; // 기본적으로 10개씩 보여줌
    let searchQuery = ""; // 검색어 초기화
    let filteredPosts = []; // 필터링된 게시글 목록
    
    // let posts = /*[[${BoardList}]]*/ [];
   

 	// 게시글 표시
    function renderPosts() {
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const postsToDisplay = filteredPosts.slice(startIndex, endIndex);

        const boardList = document.getElementById('boardList').getElementsByTagName('tbody')[0];
        boardList.innerHTML = '';

        postsToDisplay.forEach(post => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><a href="/boardview?no=${post.board_no}">${post.board_no}</a></td>
                <td><a href="/boardview?no=${post.board_no}">${post.board_title}</a></td>
                <td><a href="/boardview?no=${post.board_no}">${post.board_write}</a></td>
                <td><a href="/boardview?no=${post.board_no}">${post.board_date}</a></td>
                <td><a href="/boardview?no=${post.board_no}">${post.board_count}</a></td>
                <td><a href="/boardview?no=${post.board_no}">${post.board_like}</a></td>
            `;
            boardList.appendChild(row);
        });

        document.querySelector('.page-info').innerText = `현재 페이지: ${currentPage} / ${Math.ceil(filteredPosts.length / itemsPerPage)}`;
    }

 	// 페이지 변경
    function changePage(direction) {
        if (direction === 'prev' && currentPage > 1) {
            currentPage--;
        } else if (direction === 'next' && currentPage < Math.ceil(filteredPosts.length / itemsPerPage)) {
            currentPage++;
        }
        renderPosts();
    }

 	// 검색 기능
    function searchPosts() {
        searchQuery = document.querySelector('[name="keyword"]').value;
        const searchType = document.querySelector('[name="type"]').value;

        filteredPosts = posts.filter(post => {
            if (searchType === "title") {
                return post.board_title.includes(searchQuery);
            } else if (searchType === "writer") {
                return post.board_writer.includes(searchQuery);
            } else {
                return post.board_title.includes(searchQuery) || post.board_writer.includes(searchQuery);
            }
        });

        currentPage = 1; // 검색 시 첫 페이지로 리셋
        renderPosts();
    }

 	// 게시글 수 변경
    function updateItemsPerPage() {
        itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
        renderPosts();
    }

 	// 초기 데이터 로드
    filteredPosts = posts;
    renderPosts();
</script>

</body>
</html>
