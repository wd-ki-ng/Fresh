<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout/basic">
	<head>
		<meta charset="UTF-8">
		<title>Fresh Main page</title>
		<th:block th:insert="~{menu.html::headImport}"></th:block>
		<th:block th:insert="~{menu.html::metaImport}"></th:block>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
		<title>관리자페이지</title>
		<style>
			body {
				background-color:#f4f4f4;
			}
			a {
				color: black;
				text-decoration: none;
			}
			.adminMem {
				justify-content: center;
			}
			.adminMem .col-md-3, .adminMem .col-md-8 {
				background-color: white;
				border-right: 1px solid lightgray;
				border-bottom: 1px solid lightgray;
				border-radius: 10px;
				padding: 25px;
				margin: 10px;
			}
			.memInfo {
				height: fit-content;
			}
			.memInfoTable {
				width: 100%;
			}
			.memInfoTable h4{
				text-align: center;
			}
			.memInfoTable tbody tr{
				border-bottom: 1px solid lightgray;
			}
			.memInfoTable tbody tr:last-child{
				border-bottom: none;
			}
			.memInfoTable td{
				padding: 10px;
				font-family: 'Pretendard-Regular';
			}
			.nomalTable tr td:last-child{
				padding: 12px 14px;
			}
			.memInfoTable tfoot td{
				text-align: center;
			}
			.memInfoTable tfoot td a.btn{
				border: 1px solid lightgray;
				margin: 0px 10px;
			}
			.memInfoTable tfoot td a.btn:hover{
				background-color: gray;
				color: white;
			}
			.updateTable input[type="text"]{
				width: 100%;
			}
			.updateTable option{
				font-size: 12px;
			}
			/* 회원이 쓴 글 */
			.memPostList {
				width: 100%;
			}
			.memPostList h4 {
				text-align: center;
			}
			.memPostList table {
				width: 100%;
			}
			.memPostList tr {
				border-bottom: 1px solid lightgray;
			}
			.memPostList tbody tr:hover{
				background-color: #F9F9F9;
				cursor: pointer;
			}
			.memPostList th, .memPostList td {
				padding: 12px 14px;
			}
			.memPostList td * {
				font-family: 'Pretendard-Regular';
			}
			.memPostList td a, .memPostList td span {
				display: inline-block;
				width: 100%;
			}
			.memPostList .noPostTd {
				 text-align: center;
			}
			.memPostList tr.noPostTd:hover{
				background-color: transparent;
				cursor: text;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<!-- 상단바 - 로고, 게시판 메뉴, 검색창, 마이페이지, 로그인 -->
			<th:block th:insert="~{menu.html::navBar}"></th:block>
			<!-- 본문 -->
			<div class="row adminMem">
				<!-- 회원정보 수정 -->
				<div class="col-md-3 memInfo">
					<!-- 정보 단순 조회 -->
					<div class="memInfoTable" id="nomalTable">
						<h4>회원 정보</h4>
						<table class="memInfoTable nomalTable">
							<colgroup>
								<col width="35%"/>
								<col width="65%"/>
							</colgroup>
							<tbody>
								<tr>
									<td>회원 번호</td>
									<td th:text="${member.user_no}"></td>
								</tr>
								<tr>
									<td>회원 ID</td>
									<td th:text="${member.user_id}"></td>
								</tr>
								<tr>
									<td>회원 이름</td>
									<td th:text="${member.user_name}"></td>
								</tr>
								<tr>
									<td>회원 Email</td>
									<td th:text="${member.user_email}"></td>
								</tr>
								<tr>
									<td>회원 닉네임</td>
									<td th:text="${member.user_username}"></td>
								</tr>
								<tr>
									<td>회원 등록일</td>
									<td th:text="${#dates.format(member.user_date, 'yyyy-MM-dd')}"></td>
								</tr>
								<tr>
									<td>회원 권한</td>
									<td th:text="${member.ROLE}"></td>
								</tr>							
							</tbody>
							<tfoot>
								<tr>
									<td colspan="2">
										<a class="btn" onclick="memTableToggle()">정보 수정</a>
										<!-- <a class="btn" th:onclick="clickDel([[${member.user_name}]], [[${member.user_no}]])">회원 탈퇴</a> -->
										<a class="btn" href="#">회원 탈퇴</a>
									</td>
								</tr>
							</tfoot>
						</table>
					</div>
					
					<!-- 수정버튼 누르면 변경 -->
					<div class="memInfoTable" id="updateTable" style="display: none;">
						<h4>회원 정보 수정</h4>
						<form id="mem_udt_form" name="member" th:action="@{/admin/memUpdate}" method="post">
							<input type="hidden" name="_csrf" th:value="${_csrf.token}"/>
							<input type="hidden" name="user_no" th:value="${member.user_no}">
							<table class="memInfoTable updateTable">
								<colgroup>
									<col width="35%"/>
									<col width="65%"/>
								</colgroup>
								<tbody>
									<tr>
										<td>회원 번호</td>
										<td th:text="${member.user_no}"></td>
									</tr>
									<tr>
										<td>회원 ID</td>
										<td>
											<input type="text" th:value="${member.user_id}" name="user_id">
										</td>
									</tr>
									<tr>
										<td>회원 이름</td>
										<td>
											<input type="text" th:value="${member.user_name}" name="user_name">
										</td>
									</tr>
									<tr>
										<td>회원 Email</td>
										<td>
											<input type="text" th:value="${member.user_email}" name="user_email">
										</td>
									</tr>
									<tr>
										<td>회원 닉네임</td>
										<td>
											<input type="text" th:value="${member.user_username}" name="user_username">
										</td>
									</tr>
									<tr>
										<td>회원 등록일</td>
										<td th:text="${#dates.format(member.user_date, 'yyyy-MM-dd')}"></td>
									</tr>
									<tr>
										<td>회원 권한</td>
										<th:block th:if="${member.user_no==1}">
											<td th:text="${member.ROLE}"></td>
										</th:block>
										<th:block th:unless="${member.user_no==1}">
											<td>
												<select name="ROLE">
													<option value="ROLE_ADMIN">ROLE_ADMIN</option>
													<option value="ROLE_USER">ROLE_USER</option>
												</select>
											</td>
										</th:block>
									</tr>
								</tbody>
								<tfoot>
									<tr>
										<td colspan="2">
											<a class="btn" onclick="document.forms['member'].submit();">수정 완료</a>
											<a class="btn" onclick="memTableToggle()">수정 취소</a>
										</td>
									</tr>
								</tfoot>
							</table>
						</form>
					</div>
					
				</div>
				<!-- 회원이 쓴 글, 댓글 목록 -->
				<div class="col-md-8">
					<div class="memPostList">
						<h4 th:text="${member.user_name} + ' 회원이 작성한 글'"></h4>
						<table>
							<colgroup>
								<col width="10%"/>
								<col width="60%"/>
								<col width="15%"/>
								<col width="15%"/>
							</colgroup>
							<thead class="table_label">
								<tr>
									<th>글 번호</th>
									<th>게시글 제목</th>
									<th>추천수</th>
									<th>조회수</th>
								</tr>
							</thead>
							<tbody class="table_body">
								<th:block th:if="${#lists.size(memPosts) == 0}">
									<tr class="noPostTd">
										<td colspan="4">회원이 작성한 게시글이 없습니다.</td>
									</tr>
								</th:block>
								<tr th:each="board:${memPosts}">
									<td th:text="${board.board_no}"></td>
									<td><a th:href="@{/boardview(no=${board.board_no})}" th:text="${board.board_title}"></a></td>
									<td><span th:text="${board.board_like}"></span></td>
									<td><span th:text="${board.board_count}"></span></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		<script>
		function memTableToggle(){
			const updateTable = document.getElementById('updateTable');
			const nomalTable = document.getElementById('nomalTable');
		
			if(updateTable.style.display == 'block'){
				updateTable.style.display = 'none';
				nomalTable.style.display = 'block';
			} else {
				updateTable.style.display = 'block';
				nomalTable.style.display = 'none';
			}
		}
		</script>
		<script th:inline="javascript">
	        /*<![CDATA[*/
	        // 타임리프 URL을 동적으로 생성하여 사용할 수 있도록 설정
	        var urlTemplate = /*[[${'/admin/memDel'}]]*/ '/admin/memDel';  // 타임리프 문법으로 URL 처리
	
	        // toMemPage 함수 정의
	        function clickDel(name, userNo) {
	        	const answer = confirm('정말로 ' + name + ' 회원님을 탈퇴 처리 하시겠습니까?');
	        	
	        	if (answer){
	        		userNo = parseInt(userNo, 10);
		            // 동적으로 form 생성
		            var form = document.createElement('form');
		            form.method = 'get';
		            form.action = urlTemplate;  // 타임리프 URL 사용
		
		            // user_no 값을 hidden 필드로 전달
		            var userNoInput = document.createElement('input');
		            userNoInput.type = 'hidden';
		            userNoInput.name = 'user_no';  // 서버에서 사용할 파라미터 이름
		            userNoInput.value = userNo;  // 버튼 클릭 시 받은 user_no 값
		            form.appendChild(userNoInput);
		
		            // form을 body에 추가하고 제출
		            document.body.appendChild(form);
		            form.submit();
	        	}
	        }
	        /*]]>*/
    	</script>
	</body>
</html>